<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>


		<record id="delsol_accesories_contact_filter" model="ir.ui.view">
			<field name="name">delsol.accesories_contact.select</field>
			<field name="model">delsol.accesories_contact</field>
			<field name="arch" type="xml">
				<search>
					<separator />
					<group expand="1" string="Agrupar por">
						<filter string="Estado contacto" name="contact_state" domain="[ ]"
							context="{'group_by': 'state'}" />
						<filter string="Estado instalacion" name="install_state" domain="[ ]"
							context="{'group_by': 'state_install'}" />
						<filter string="Prioridad" name="priority" domain="[ ]"
							context="{'group_by': 'priority'}" />
					</group>
					<separator />

					<filter string="Instalaciones" name="installations" domain="[('accesories_request','=', True)]" />
				</search>
			</field>
		</record>




		<record id="delsol_accesories_contact_tree" model="ir.ui.view">
			<field name="name">delsol.accesories_contact.tree</field>
			<field name="model">delsol.accesories_contact</field>
			<field name="arch" type="xml">
			
				<tree string="Contactos por accesorios" default_order="programmed_install_date desc" colors="red:priority=='high'">
					<field name="vehicle_id" />
					<field name="state" />
					<field name="state_install" />
					<field name="programmed_install_date" />					
					<field name="client_phone" />
					<field name="accesories_ids" />
					<field name="annotations" />
					<field name="priority" invisible="1"/>
				</tree>
			</field>
		</record>

		<record id="delsol_accesories_contact_form" model="ir.ui.view">
			<field name="name">delsol.accesories_contact.form</field>
			<field name="model">delsol.accesories_contact</field>
			<field name="arch" type="xml">
				<form string="Contacto de accesorios">
					<header>
					<field name="id" invisible="1"></field>
					<field name="init_install_date" invisible="1"></field>
					<field name="end_install_date" invisible="1"></field>
					<field name="button_end_install_date_visible" invisible="1"></field>
					<div attrs="{'invisible':['|',('accesories_request','=', False),('state','=','not_contacted')]}" class="oe_inline oe_read_only">
						<button name="init_install" string="Iniciar Instalacion" type="object" attrs="{'invisible':[('init_install_date','!=',False)]}" 
							class="oe_highlight" groups="accesorios.group_name_accesories_gestor"/>
						<button name="end_install" string="Finalizar Instalacion" type="object" attrs="{'invisible':[('button_end_install_date_visible','==',False)]}" 
							class="oe_highlight" groups="accesorios.group_name_accesories_gestor"/>
					</div>
					</header>
					<sheet string="Contacto e instalacion">
						<group>
							<group string="Datos del vehiculo/cliente">
								<field name="vehicle_id" options="{'no_create_edit': True,'no_create': True}" 
									domain="[('accesories_contact','=',False),('client_id','!=',False),('state','not in',('dispatched','delivered')),('vehicle_type','=','auto')]"/>
								<field name="vehicle_model_id" options="{'no_create_edit': True}" />
								<field name="client_id" options="{'no_create_edit': True}" />
								<field name="client_phone" attrs="{'readonly':True}" />
								<field name="client_mobile" attrs="{'readonly':True}" />
							</group>
							<group string="Datos del contacto">
								<field name="state"/>
								<field name="create_date" class="oe_read_only"/>
								<field name="accesories_request"  attrs="{'invisible': [('state','=', 'not_contacted')]}"/>
								<field name="accesories_ids" widget="many2many_tags"  options="{'no_create_edit': True}" attrs="{'invisible': ['|',('state','=', 'not_contacted'),('accesories_request','=', False)]}"/>
								<field name="annotations" />
							</group>
						</group>
						<group>
							<group>
								<div attrs="{'invisible':[('delivery_date','!=',False)]}" class="oe_form_field_label"><b>Fecha de entrega</b></div>
								<div attrs="{'invisible':[('delivery_date','!=',False)]}" class="oe_form_field_char">
									La fecha de entrega no ha sido pactada aun.
								</div>
								<field name="sector" readonly="1"/>
							</group>
						</group>
						<group attrs="{'invisible': ['|',('state','=', 'not_contacted'),('accesories_request','=', False)]}">
							<group string="Programacion">
								<field name="delivery_date" readonly="1" attrs="{'invisible':[('delivery_date','==',False)]}"/>
								<field name="programmed_install_date" />
							</group>
							<group string="Datos de la instalacion" class="oe_read_only">
								<field name="state_install" readonly="1"/>
								<field name="init_install_date" />
								<field name="end_install_date" />
							</group>
						</group>
					</sheet>
				</form>
			</field>
		</record>


	<record model='ir.ui.view' id='delsol_accesories_contact_calendar'>
		<field name="name">delsol.accesories_contact.calendar</field>
		<field name="model">delsol.accesories_contact</field>
		<field name="arch" type="xml">
			<calendar string="Calendario" event_open_popup="True" color="state_install" date_start="programmed_install_date" 
				date_delay="install_duration" quick_add="False" display="[vehicle_id] ; [accesories_ids]">
				<field name="vehicle_id"/>
				<field name="accesories_ids"/>
			</calendar>
		</field>
	</record>

		<record id="open_view_accesories_install_all" model="ir.actions.act_window">
			<field name="name">Instalacion de accesorios pendiente</field>
			<field name="res_model">delsol.accesories_contact</field>
			<field name="view_type">form</field>
			<field name="context">{
				'search_default_installations': 1,
				'search_default_priority': 1,
				}
			</field>
			<field name="domain">[]</field>
			<field name="view_mode">calendar,tree,form</field>
		</record>
		

	</data>
</openerp>