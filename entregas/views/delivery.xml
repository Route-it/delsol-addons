<?xml version="1.0" encoding="UTF-8"?>

<openerp>
	<data>

		<record id="reprogramming_wizard_action" model="ir.actions.act_window">
			<field name="name">Reprogramación</field>
			<field name="res_model">delsol.wizard_reprogramming</field>
			<field name="src_model">delsol.delivery</field>
			<field name="view_type">form</field>
			<field name="view_mode">form</field>
			<field name="target">new</field>
		</record>


		<record id="delsol_delivery_filter" model="ir.ui.view">
			<field name="name">delsol.delivery.select</field>
			<field name="model">delsol.delivery</field>
			<field name="arch" type="xml">
				<search>
					<field name="name" string="Entrega" />
					<field name="client_id" string="Cliente" />
					<field name="vehicle_id" string="Vehiculo" />
					<field name="vendor_id" string="Vendedor" />
					<field name="vehicle_chasis" string="Nro Chasis" />
					<separator />
					<filter string="Este mes" name="this_month" domain="[('delivery_date','&lt;',(context_today()+relativedelta(months=1)).strftime('%Y-%m-01')), ('delivery_date','&gt;=',time.strftime('%Y-%m-01'))]"/>
					<separator />
					<filter string="Camiones" name="camiones" domain="[('sector','=','camiones')]" />
					<filter string="Autos" name="autos" domain="[('sector','!=','camiones')]" />
				</search>
			</field>
		</record>
		
		<record id="delsol_delivery_graph" model="ir.ui.view">
			<field name="name">delsol.delivery.graph</field>
        	<field name="model">delsol.delivery</field>
        	<field name="arch" type="xml">
        		<graph string="Entregas" type="line">
        		    <field name="delivery_date" type="row" interval="month"/>
        		</graph>
        	</field>
    	</record>
    	
    	<record id="delsol_delivery_delivery_pivot" model="ir.ui.view">
			<field name="name">delsol.delivery.pivot</field>
			<field name="model">delsol.delivery</field>
			<field name="arch" type="xml">
				<pivot string="Entregas Pivot">
				</pivot>
			</field>
		</record>

<!--         <record id="view_production_gantt" model="ir.ui.view"> -->
<!--             <field name="name">delsol.delivery.gantt</field> -->
<!--             <field name="model">delsol.delivery</field> -->
<!--             <field name="arch" type="xml"> -->
<!--                 <gantt date_stop="date_finished" date_start="delivery_date" progress="progress" string="Productions" default_group_by="state"> -->
<!--                 </gantt> -->
<!--             </field> -->
<!--         </record> -->



		<record model='ir.ui.view' id='delsol_delivery_list'>
			<field name="name">delsol.delivery.tree</field>
			<field name="model">delsol.delivery</field>
			<field name="arch" type="xml">
				<tree string="Entregas" default_order="delivery_date desc">
					<field name="client_id" string="Cliente"/>
					<field name="vehicle_id" string="Vehiculo" />
					<field name="delivery_date" string="Fecha Entrega" />
					<field name="state" string="Estado"/>
				</tree>
			</field>
		</record>

		<record model='ir.ui.view' id='delsol_delivery_form'>
			<field name="name">delsol.delivery.form</field>
			<field name="model">delsol.delivery</field>
			<field name="arch" type="xml">
				<form string="Entregas">
					<header>
						<field name="id" invisible="1" />
						<field name="client_arrival" invisible="1"/>
						<div style="display:none;">
							<field name="vehicle_pass_predelivery_proccess" invisible="1"/>
						</div>
						<field name="button_delivery_visible" invisible="1"/>

						<div  attrs="{'invisible':[('id','==',False)]}" style="display: inline">
							<button name="%(reprogramming_wizard_action)d" string="Reprogramar" type="action" attrs="{'invisible':[('state','=','delivered')]}"
								groups="entregas.group_name_reprogram"/>
						<div attrs="{'invisible':[('vehicle_pass_predelivery_proccess','=',True)]}" class="oe_inline" style="display: inline">
							<button name="stamp_client_arrival" string="Cliente en concesionaria" type="object" attrs="{'invisible':['|',('client_arrival','!=',False),('state','not in',('new','reprogrammed'))]}"
								groups="entregas.group_name_client_in_dealer"/>
						</div>
							<!-- pasar a un campo calculado la visibilidad de este boton -->
							<button name="set_delivered" string="Entregar" type="object" class="oe_highlight" attrs="{'invisible':[('button_delivery_visible','==',False)]}"
								groups="entregas.group_name_delivered"/>
							<button name="set_dispatched" string="Despachar" type="object" class="oe_highlight"  attrs="{'invisible':['|',('client_arrival','!=',False),('state','not in',('new','reprogrammed'))]}"
								groups="entregas.group_name_dispatched"/>
							<button name="%(change_delivery_state_wizard_action)d" string="Cambiar Estado"
								type="action" groups="entregas.group_name_set_any_delivery_state" />
						</div>

						<field name="state" widget="statusbar" statusbar_visible="new,reprogrammed,dispatched,delivered"
							statusbar_colors='{"new":"blue"}'/>
					</header>
					<sheet>
	                    <div class="oe_button_box" name="button_box" invisible="1">
	                        <button name="toggle_active" type="object" groups="base.group_no_one"
	                                class="oe_stat_button" icon="fa-archive" attrs="{'invisible':[('state','not in',('dispatched','delivered'))]}">
	                            <field name="active" widget="boolean_button"
	                                options='{"terminology": "archive"}'/>
	                        </button>
	                        

   	                        <button name="download_report_turn" string="Comprobante de entrega" type="object" icon="gtk-print" attrs="{'invisible':[('id','==',False)]}">
   	                        </button>
   	                        <field name="client_email" invisible="1"/>
   	                        <button name="send_report_turn_to_client" string="Enviar comprobante de entrega" type="object" 
   	                        		icon="terp-mail-forward" attrs="{'invisible':['|',('id','==',False),('client_email','==',False)]}"/>
                		</div>

	                    <field name="vehicle_state" invisible="1"/>
						<div style="background-color:yellow" attrs="{'invisible':[('vehicle_state','not in',('damage'))]}">
										El vehiculo se encuentra averiado
						</div>
						<group string="Datos de la entrega">
							<group>                               
	   	                        <field name="client_vehicle_readonly" invisible="1"/>
								<field name="client_id" string="Cliente" readonly="1"/>
								<field name="vehicle_id" string="Vehiculo"  attrs="{'readonly': [('client_vehicle_readonly', '=', True)]}" 
											options="{'no_create_edit': True}" />
<!-- 											domain="[('state','in',('to_be_delivery','ready_for_delivery','damage'))]" class="display:inline"  /> -->
								<field name="delivery_date" attrs="{'readonly': [('id', '!=', False)]}"/>
								<field name="client_date" attrs="{'readonly': [('id', '!=', False)]}"/>
								<field name="create_date" readonly="1"  attrs="{'invisible':[('id','==',False)]}"/>
								<field name="sector"  attrs="{'readonly': [('client_vehicle_readonly', '=', True)]}"/>
								
								<field name="vendor_id" string="Vendedor" options="{'no_create_edit': True}" />
								<field name="tae_stamp" attrs="{'invisible':['|',('id','==',False),('state','not in',('delivered'))]}"/>
								<field name="client_arrival" attrs="{'invisible':[('client_arrival','=',False)]}"/>
							</group>
						</group>
						<notebook>
							<page string="Reprogramaciones" attrs="{'invisible':[('reprogramming_ids','=',[])]}">
								<field name="reprogramming_ids" string="Reprogramaciones" context="{'delivery_id':id}"
									attrs="{'readonly':'True'}" />
							</page>
							
						</notebook>

					</sheet>
					<div class="oe_chatter oe_read_only">
						<field name="message_follower_ids" widget="mail_followers" />
						<field name="message_ids" widget="mail_thread" />
					</div>

				</form>
			</field>
		</record>
		

<!-- 		<record model="ir.ui.view" id="delsol_delivery_form_for_contact_resp"> -->
<!-- 			<field name="name">delsol.delivery.form.for.contact</field> -->
<!-- 			<field name="model">delsol.delivery</field> -->
<!-- 			<field name="inherit_id" ref="delsol_delivery_form" /> -->
<!-- 			<field name="groups_id" eval="[(6,0,[ref('rqr.group_name_contact')])]" /> -->
<!-- 			<field name="arch" type="xml"> -->
<!-- 				<xpath expr="//field[@name='client_id']" position="attributes"> -->
<!-- 					<attribute name="readonly">1</attribute> -->
<!-- 				</xpath> -->
<!-- 				<xpath expr="//field[@name='vehicle_id']" position="attributes"> -->
<!-- 					<attribute name="readonly">1</attribute> -->
<!-- 				</xpath> -->
<!-- 				<xpath expr="//field[@name='delivery_date']" position="attributes"> -->
<!-- 					<attribute name="readonly">1</attribute> -->
<!-- 				</xpath> -->
<!-- 				<xpath expr="//field[@name='vendor_id']" position="attributes"> -->
<!-- 					<attribute name="readonly">1</attribute> -->
<!-- 				</xpath> -->
<!-- 			</field> -->
<!-- 		</record> -->

		
		<record model="ir.ui.view" id="reprogramming_wizard_view">
            <field name="name">delsol.reprogramming.wizard.form</field>
            <field name="model">delsol.wizard_reprogramming</field>
            <field name="arch" type="xml">
                <form string="Reprogramar entrega">
                    <group>
                        <field name="new_date"/>
                        <field name="new_delivery_date"/>
                        <field name="responsible"/>
                        <field name="reason"/>
                    </group>
                    <footer>
                        <button name="reprogram" type="object"
                                string="Reprogramar" class="oe_highlight"/>
                        
                        <button special="cancel" string="Cancel"/>
                    </footer>
                </form>
            </field>
        </record>
		

		<record model='ir.ui.view' id='delsol_delivery_calendar'>
			<field name="name">delsol.delivery.calendar</field>
			<field name="model">delsol.delivery</field>
			<field name="arch" type="xml">
				<calendar string="Planificacion de Entregas"
					event_open_popup="True" color="sector" date_start="delivery_date" 
					date_delay="turn_duration" quick_add="False" display="[client_id] ; [vehicle_id] ; [vehicle_chasis] ; [vehicle_color]">
					<field name="client_id" string="Cliente" />
					<field name="vehicle_id" string="Vehiculo" />
					<field name="delivery_date" string="Fecha Entrega" />
					<field name="vehicle_chasis"/>
					<field name="sector"/>
					<field name="vehicle_color"/>
				</calendar>
			</field>
		</record>


		
		<record model='ir.ui.view' id='delsol_reprogramming_list'>
			<field name="name">delsol.reprogramming.tree</field>
			<field name="model">delsol.reprogramming</field>
			<field name="arch" type="xml">
				<tree string="Reprogramaciones">
					<field name="from_date"/>
					<field name="to_date"/>
					<field name="responsible"/>
				</tree>
			</field>
		</record>
		
		<record model="ir.ui.view" id="delsol_reprogramming_form">
            <field name="name">delsol.reprogramming.form</field>
            <field name="model">delsol.reprogramming</field>
            <field name="arch" type="xml">
                <form string="Reprogramación" >
                    <group>
                    	<field name="from_date"/>
                        <field name="to_date"/>
                        <field name="responsible"/>
                        <field name="reason"/>
                    </group>
                </form>
            </field>
        </record>

        <record id="delsol_delivery_gantt" model="ir.ui.view">
            <field name="name">delsol.delivery.gantt</field>
            <field name="model">delsol.delivery</field>
            <field name="arch" type="xml">
<!--                 <gantt date_stop="closed_date" date_start="progress_date" progress="progress" string="Rqr" default_group_by="sector"> -->
                <gantt date_delay="turn_duration" date_start="delivery_date" progress="100" string="Rqr" default_group_by="sector">
                </gantt>
            </field>
        </record>



		<record id="open_view_delivery_cam_all" model="ir.actions.act_window">
			<field name="name">Entregas de Camiones</field>
			<field name="res_model">delsol.delivery</field>
			<field name="view_type">form</field>
			<field name="context">{
  					'search_default_camiones': 1
					}
			</field>		
			<field name="domain">[]</field>
			<field name="view_mode">tree,form,calendar,graph,pivot</field>
		</record>

		<record id="open_view_delivery_all" model="ir.actions.act_window">
			<field name="name">Entregas de Autos</field>
			<field name="res_model">delsol.delivery</field>
			<field name="view_type">form</field>
			<field name="context">{
  					'search_default_autos': 1
					}
			</field>		
			<field name="domain">[]</field>
			<field name="view_mode">tree,form,calendar,graph,pivot</field>
		</record>

	</data>
</openerp>